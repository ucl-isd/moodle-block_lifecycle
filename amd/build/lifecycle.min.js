define("block_lifecycle/lifecycle",["exports","core/ajax","core/notification"],(function(_exports,_ajax,_notification){function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}Object.defineProperty(_exports,"__esModule",{value:!0}),_exports.init=void 0,_ajax=_interopRequireDefault(_ajax),_notification=_interopRequireDefault(_notification);var defaultfreezedate="",originalfreezedatevalue="";function togglesettings(){var content=document.getElementById("automatic-read-only-settings");document.getElementById("override-freeze-date-button").classList.toggle("active"),content.style.maxHeight?content.style.maxHeight=null:content.style.maxHeight=content.scrollHeight+"px"}function initscheduledfreezedateblock(courseid){var scheduledfreezedatecontainer=document.getElementById("scheduled-freeze-date-container");originalfreezedatevalue=document.getElementById("delayfreezedate").value,document.getElementById("togglefreezebutton").checked?(document.getElementById("scheduled-freeze-date").innerHTML="",scheduledfreezedatecontainer.style.display="block",_ajax.default.call([{methodname:"block_lifecycle_get_scheduled_freeze_date",args:{courseid:courseid}}])[0].done((function(response){document.getElementById("scheduled-freeze-date").innerHTML=response.scheduledfreezedate,"true"===response.success&&(defaultfreezedate=response.defaultfreezedate)})).fail((function(err){window.console.log(err)}))):scheduledfreezedatecontainer.style.display="none"}_exports.init=function(courseid){document.getElementById("lifecycle-settings-container")&&(initscheduledfreezedateblock(courseid),document.getElementById("update_auto_freezing_preferences_button").addEventListener("click",(function(){!function(courseid){var preferences={togglefreeze:document.getElementById("togglefreezebutton").checked,delayfreezedate:document.getElementById("delayfreezedate").value};(function(){var freezedateelement=document.getElementById("delayfreezedate");if(!document.getElementById("togglefreezebutton").checked&&freezedateelement.value.length>0)return _notification.default.alert("Invalid selection","Please enable automatic read only or remove the overrides Read-Only date.","OK"),!1;if(freezedateelement.value.length>0){if(""===defaultfreezedate)return _notification.default.alert("Error","Could not get the automatically suggested date, please try again later.","OK"),freezedateelement.value=originalfreezedatevalue,!1;var defaultfreezedateobj=new Date(defaultfreezedate),freezedateobj=new Date(freezedateelement.value);if(freezedateobj<defaultfreezedateobj||freezedateobj<new Date)return _notification.default.alert("Invalid Selection","The date for a Read-Only override must be post the automatically suggested date ("+defaultfreezedateobj.toLocaleDateString()+"), earlier dates may not be used.","OK"),freezedateelement.value=originalfreezedatevalue,!1}return!0})()&&_ajax.default.call([{methodname:"block_lifecycle_update_auto_freezing_preferences",args:{courseid:courseid,preferences:JSON.stringify(preferences)}}])[0].done((function(response){_notification.default.addNotification({message:response.message,type:response.success?"success":"error"}),initscheduledfreezedateblock(courseid),togglesettings()})).fail((function(err){window.console.log(err)}))}(courseid)})),document.getElementById("override-freeze-date-button").addEventListener("click",(function(e){e.preventDefault(),togglesettings()})))}}));

//# sourceMappingURL=lifecycle.min.js.map