{"version":3,"file":"lifecycle.min.js","sources":["../src/lifecycle.js"],"sourcesContent":["import Ajax from 'core/ajax';\nimport notification from 'core/notification';\n\nexport const init = (courseid) => {\n    initscheduledfreezedateblock(courseid);\n    document.getElementById('update_auto_freezing_preferences_button').addEventListener('click', () => {\n        updatepreferences(courseid);\n    });\n\n    document.getElementById('override-freeze-date-button').addEventListener(\"click\", function(e) {\n        e.preventDefault();\n        togglesettings();\n    });\n};\n\n/**\n * Toggle the automatic read only settings container.\n */\nfunction togglesettings() {\n    let content = document.getElementById('automatic-read-only-settings');\n    document.getElementById('override-freeze-date-button').classList.toggle('active');\n    if (content.style.maxHeight) {\n        content.style.maxHeight = null;\n    } else {\n        content.style.maxHeight = content.scrollHeight + \"px\";\n    }\n}\n\n/**\n * Validate the preferences.\n * @return {boolean}\n */\nfunction validate() {\n    if (!document.getElementById('togglefreezebutton').checked && document.getElementById('delayfreezedate').value.length > 0) {\n        notification.alert(\n            'Invalid selection',\n            'Please enable automatic read only or remove the overrides freeze date.',\n            'OK'\n        );\n        return false;\n    }\n    return true;\n}\n\n/**\n * Initialize the scheduled freeze date container.\n *\n * @param {int} courseid\n */\nfunction initscheduledfreezedateblock(courseid) {\n    let scheduledfreezedatecontainer = document.getElementById('scheduled-freeze-date-container');\n\n    if (document.getElementById('togglefreezebutton').checked) {\n        document.getElementById('scheduled-freeze-date').innerHTML = '';\n        scheduledfreezedatecontainer.style.display = 'block';\n        Ajax.call([{\n            methodname: 'block_lifecycle_get_scheduled_freeze_date',\n            args: {\n                'courseid': courseid\n            },\n        }])[0].done(function(response) {\n            document.getElementById('scheduled-freeze-date').innerHTML = response.scheduledfreezedate;\n        }).fail(function(err) {\n            window.console.log(err);\n        });\n    } else {\n        scheduledfreezedatecontainer.style.display = 'none';\n    }\n}\n\n/**\n * Update the auto context freezing preferences.\n * @param {int} courseid\n */\nfunction updatepreferences(courseid) {\n    let preferences = {\n        togglefreeze: document.getElementById('togglefreezebutton').checked,\n        delayfreezedate: document.getElementById('delayfreezedate').value\n    };\n\n    if (validate()) {\n        Ajax.call([{\n            methodname: 'block_lifecycle_update_auto_freezing_preferences',\n            args: {\n                'courseid': courseid,\n                'preferences': JSON.stringify(preferences)\n            },\n        }])[0].done(function(response) {\n            notification.addNotification({\n                message: response.message,\n                type: response.success ? 'success' : 'error'\n            });\n            initscheduledfreezedateblock(courseid);\n            togglesettings();\n        }).fail(function(err) {\n            window.console.log(err);\n        });\n    }\n}\n"],"names":["togglesettings","content","document","getElementById","classList","toggle","style","maxHeight","scrollHeight","initscheduledfreezedateblock","courseid","scheduledfreezedatecontainer","checked","innerHTML","display","call","methodname","args","done","response","scheduledfreezedate","fail","err","window","console","log","addEventListener","preferences","togglefreeze","delayfreezedate","value","length","alert","validate","JSON","stringify","addNotification","message","type","success","updatepreferences","e","preventDefault"],"mappings":"uXAkBSA,qBACDC,QAAUC,SAASC,eAAe,gCACtCD,SAASC,eAAe,+BAA+BC,UAAUC,OAAO,UACpEJ,QAAQK,MAAMC,UACdN,QAAQK,MAAMC,UAAY,KAE1BN,QAAQK,MAAMC,UAAYN,QAAQO,aAAe,cAyBhDC,6BAA6BC,cAC9BC,6BAA+BT,SAASC,eAAe,mCAEvDD,SAASC,eAAe,sBAAsBS,SAC9CV,SAASC,eAAe,yBAAyBU,UAAY,GAC7DF,6BAA6BL,MAAMQ,QAAU,sBACxCC,KAAK,CAAC,CACPC,WAAY,4CACZC,KAAM,UACUP,aAEhB,GAAGQ,MAAK,SAASC,UACjBjB,SAASC,eAAe,yBAAyBU,UAAYM,SAASC,uBACvEC,MAAK,SAASC,KACbC,OAAOC,QAAQC,IAAIH,SAGvBX,6BAA6BL,MAAMQ,QAAU,qBA/DjC,SAACJ,UACjBD,6BAA6BC,UAC7BR,SAASC,eAAe,2CAA2CuB,iBAAiB,SAAS,qBAqEtEhB,cACnBiB,YAAc,CACdC,aAAc1B,SAASC,eAAe,sBAAsBS,QAC5DiB,gBAAiB3B,SAASC,eAAe,mBAAmB2B,uBA5C3D5B,SAASC,eAAe,sBAAsBS,SAAWV,SAASC,eAAe,mBAAmB2B,MAAMC,OAAS,+BACvGC,MACT,oBACA,yEACA,OAEG,SAEJ,GAuCHC,kBACKlB,KAAK,CAAC,CACPC,WAAY,mDACZC,KAAM,UACUP,qBACGwB,KAAKC,UAAUR,iBAElC,GAAGT,MAAK,SAASC,gCACJiB,gBAAgB,CACzBC,QAASlB,SAASkB,QAClBC,KAAMnB,SAASoB,QAAU,UAAY,UAEzC9B,6BAA6BC,UAC7BV,oBACDqB,MAAK,SAASC,KACbC,OAAOC,QAAQC,IAAIH,QAzFvBkB,CAAkB9B,aAGtBR,SAASC,eAAe,+BAA+BuB,iBAAiB,SAAS,SAASe,GACtFA,EAAEC,iBACF1C"}